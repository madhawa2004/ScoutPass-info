<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScoutPass </title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root { --primary: #4F46E5; --bg: #F8FAFC; --white: #ffffff; --sidebar-w: 260px; }
        body { background-color: var(--bg); font-family: 'Plus Jakarta Sans', sans-serif; color: #1e293b; overflow-x: hidden; }

        .sidebar { position: fixed; top: 0; left: 0; height: 100vh; width: var(--sidebar-w); background: var(--white); border-right: 1px solid #e2e8f0; padding: 25px 20px; z-index: 1000; display: flex; flex-direction: column; }
        .brand { font-size: 1.5rem; font-weight: 800; color: #0f172a; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .nav-item { padding: 12px 16px; border-radius: 12px; margin-bottom: 5px; cursor: pointer; color: #64748b; font-weight: 600; display: flex; align-items: center; gap: 12px; transition: 0.2s; }
        .nav-item:hover { background: #f1f5f9; color: var(--primary); }
        .nav-item.active { background: #e0e7ff; color: var(--primary); }
        
        .main-content { margin-left: var(--sidebar-w); padding: 30px; }
        
        .stat-card { background: var(--white); border-radius: 16px; padding: 24px; border: 1px solid #e2e8f0; box-shadow: 0 2px 4px rgba(0,0,0,0.02); height: 100%; transition: 0.3s; }
        .stat-val { font-size: 2.5rem; font-weight: 800; margin-top: 5px; color: #0f172a; }
        .stat-lbl { font-size: 0.75rem; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; }

        /* Real-Time Grid Styles */
        .rt-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-top: 15px; text-align: center; padding-top: 15px; border-top: 1px solid #f1f5f9; }
        .rt-val { font-size: 1.2rem; font-weight: 700; }
        .rt-lbl { font-size: 0.7rem; font-weight: 700; color: #94a3b8; }

        .table-custom th { background: #f8fafc; font-size: 0.75rem; text-transform: uppercase; color: #64748b; }
        .role-admin-only { display: none; }
        #loadingOverlay { position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; }
        #qr-hidden { display: none; }
    </style>
</head>
<body>

<div id="qr-hidden"></div>
<div id="loadingOverlay"><div class="spinner-border text-primary"></div></div>

<div class="sidebar">
    <div class="brand"><i class="bi bi-shield-check text-primary"></i> ScoutPass <span class="badge bg-primary-subtle text-primary fs-6 ms-2" id="roleBadge">...</span></div>
    <div class="nav-item active" onclick="showSection('dashboard', this)"><i class="bi bi-grid-fill"></i> War Room</div>
    <div class="nav-item" onclick="showSection('search', this)"><i class="bi bi-search"></i> Search</div>
    <div class="nav-item" onclick="showSection('registration', this)"><i class="bi bi-person-plus-fill"></i> Registration</div>
    <div class="nav-item" onclick="showSection('events', this)"><i class="bi bi-calendar-event"></i> Events</div>
    <div class="nav-item" onclick="showSection('data', this)"><i class="bi bi-database"></i> Data Center</div>
    <div class="role-admin-only">
        <div class="nav-item" onclick="showSection('staff', this)"><i class="bi bi-people-fill"></i> Staff</div>
        <div class="nav-item" onclick="showSection('settings', this)"><i class="bi bi-gear-fill"></i> Settings</div>
    </div>
    <div style="margin-top: auto;"><div class="nav-item text-danger" onclick="logout()"><i class="bi bi-box-arrow-left"></i> Logout</div></div>
</div>

<div class="main-content">

    <div id="sec-dashboard" class="section animate__animated animate__fadeIn">
        <h3 class="fw-bold mb-4">War Room Overview</h3>
        
        <div class="row g-4 mb-5">
            <div class="col-md-4"><div class="stat-card border-start border-4 border-primary"><div class="stat-lbl">Registered</div><div class="stat-val" id="liveReg">0</div></div></div>
            <div class="col-md-4"><div class="stat-card border-start border-4 border-warning"><div class="stat-lbl">Total Scans</div><div class="stat-val text-primary" id="liveScans">0</div></div></div>
            <div class="col-md-4"><div class="stat-card border-start border-4 border-success"><div class="stat-lbl">Inside Premises</div><div class="stat-val text-success" id="liveInside">0</div></div></div>
        </div>

        <h5 class="fw-bold mb-3 text-secondary">Active Operations</h5>
        <div class="row g-4" id="dashboardEvents">
            <div class="col-12 text-muted">Waiting for data stream...</div>
        </div>
    </div>

    <div id="sec-search" class="section" style="display:none;">
        <h3 class="fw-bold mb-3">Profile Search</h3>
        <div class="stat-card" style="max-width: 800px;">
            <div class="input-group mb-4">
                <input id="sInput" class="form-control form-control-lg bg-light" placeholder="Enter ID (e.g. KG001)">
                <button class="btn btn-primary fw-bold px-4" onclick="performSearch()">Search</button>
            </div>
            <div id="sResult" style="display:none;" class="p-3 bg-light rounded border">
                <div class="d-flex justify-content-between">
                    <div><h2 id="sName" class="fw-bold m-0">-</h2><span class="badge bg-dark" id="sID">-</span></div>
                    <button onclick="dlCard()" class="btn btn-sm btn-outline-dark"><i class="bi bi-printer"></i> ID Card</button>
                </div>
                <hr>
                <div class="row mt-3">
                    <div class="col-4"><strong>Emergency:</strong><br><span id="sEmg">-</span></div>
                    <div class="col-4"><strong>Medical:</strong><br><span id="sMed" class="text-danger fw-bold">-</span></div>
                    <div class="col-4"><strong>Leader:</strong><br><span id="sLdr">-</span></div>
                </div>
            </div>
        </div>
    </div>

    <div id="sec-registration" class="section" style="display:none;">
        <h3 class="fw-bold mb-3">Registration Wizard</h3>
        <div class="stat-card">
            <h5 class="fw-bold mb-3">Step 1: Input Data</h5>
            <div class="alert alert-info small border-0 bg-primary-subtle text-primary mb-2">Format: <b>ID, Name, Emergency, Medical, Leader</b></div>
            <textarea id="csvInput" class="form-control mb-3 bg-light" rows="5" placeholder="KG001, Amal, 0771234567, None, 071888"></textarea>
            <button class="btn btn-dark fw-bold px-4" onclick="parseCSV()">Preview Data</button>
        </div>
        <div id="previewArea" style="display:none;" class="mt-4">
            <div class="stat-card border-primary border-2">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold text-primary m-0">Step 2: Verify & Print</h5>
                    <button class="btn btn-primary fw-bold" onclick="registerAndPrint()">Register & Print</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-custom table-hover">
                        <thead><tr><th>ID</th><th>Name</th><th>Emergency</th><th>Medical</th><th>Leader</th></tr></thead>
                        <tbody id="previewBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="sec-events" class="section" style="display:none;">
        <h3 class="fw-bold mb-3">Event Configuration</h3>
        <div class="row g-4">
            <div class="col-md-5">
                <div class="stat-card">
                    <h5 class="fw-bold mb-4">Create Event</h5>
                    <input id="evtName" class="form-control mb-3" placeholder="Event Name">
                    <select id="evtCat" class="form-select mb-3" onchange="autoFill()"><option value="ENTRANCE">Entrance</option><option value="ACTIVITY">Activity</option></select>
                    <select id="evtMode" class="form-select mb-3"><option value="FAST">Fast Mode</option><option value="DETAILS">Detail Mode</option></select>
                    <input id="evtBtns" class="form-control mb-4" value="IN,OUT">
                    <button class="btn btn-primary w-100 fw-bold" onclick="createNewEvent()">CREATE EVENT</button>
                </div>
            </div>
            <div class="col-md-7">
                <div class="stat-card">
                    <h5 class="fw-bold mb-3">Active Events</h5>
                    <div id="eventList"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="sec-data" class="section" style="display:none;">
        <h3 class="fw-bold mb-3">Data Center</h3>
        <div class="row g-4">
            <div class="col-md-4"><div class="stat-card border-top border-4 border-info"><h5 class="fw-bold">Logs</h5><button class="btn btn-info text-white w-100 fw-bold mt-3" onclick="exportLogs()">Export CSV</button></div></div>
            <div class="col-md-4"><div class="stat-card border-top border-4 border-success"><h5 class="fw-bold">Backup</h5><button class="btn btn-outline-success w-100 mb-2 mt-3" onclick="backupDB()">Backup</button><button class="btn btn-success w-100" onclick="document.getElementById('restFile').click()">Restore</button><input type="file" id="restFile" hidden onchange="restoreDB(this)"></div></div>
            <div class="col-md-4 role-admin-only"><div class="stat-card border-top border-4 border-danger"><h5 class="fw-bold text-danger">Reset</h5><button class="btn btn-danger w-100 fw-bold mt-3" onclick="sysReset()">RESET SYSTEM</button></div></div>
        </div>
    </div>

    <div id="sec-staff" class="section" style="display:none;">
        <h3 class="fw-bold mb-3">Staff Management</h3>
        <div class="stat-card">
            <div class="row g-2 align-items-end">
                <div class="col-3"><input id="uEmail" class="form-control" placeholder="Email"></div>
                <div class="col-3"><input id="uPass" class="form-control" placeholder="Pass"></div>
                <div class="col-3"><select id="uRole" class="form-select"><option value="scanner">Scanner</option><option value="moderator">Moderator</option><option value="admin">Admin</option></select></div>
                <div class="col-3"><button onclick="addUser()" class="btn btn-success w-100 fw-bold">Add</button></div>
            </div>
            <hr class="my-4">
            <table class="table table-hover align-middle"><tbody id="userTable"></tbody></table>
        </div>
    </div>

    <div id="sec-settings" class="section" style="display:none;">
        <div class="stat-card">
            <div class="form-check form-switch fs-5"><input class="form-check-input" type="checkbox" id="lockSw" onchange="setLock(this.checked)"><label class="fw-bold ms-2">Global Lock</label></div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signOut, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, onValue, get, update, push, remove, increment, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = { apiKey: "AIzaSyDJtFyERA8CKD683DdCUgRKoO7CalB403Q", authDomain: "scoutpassinfo.firebaseapp.com", databaseURL: "https://scoutpassinfo-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "scoutpassinfo", storageBucket: "scoutpassinfo.firebasestorage.app", messagingSenderId: "275495941550", appId: "1:275495941550:web:516a5b1429dbf8d80e443f" };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const secApp = initializeApp(firebaseConfig, "Secondary");
    const secAuth = getAuth(secApp);

    let role = 'scanner';
    let parsedData = [], foundScout = null;
    let globalEvents = {};
    let globalStats = {};

    // 1. AUTH
    onAuthStateChanged(auth, async (u) => {
        if(!u) window.location.href="index.html";
        else {
            const s = await get(ref(db, `users/${u.uid}`));
            if(s.exists()) {
                role = s.val().role;
                document.getElementById('roleBadge').innerText = role.toUpperCase();
                document.querySelectorAll('.role-admin-only').forEach(e => e.style.display = role==='admin'?'block':'none');
                startListeners(); // Only start AFTER Auth
            }
        }
    });

    // 2. REAL-TIME LISTENERS (The Fix)
    function startListeners() {
        // A. Watch Global Stats
        onValue(ref(db, 'stats'), s => {
            const d = s.val() || {};
            document.getElementById('liveReg').innerText = d.total_registered || 0;
            document.getElementById('liveScans').innerText = d.total_scans || 0;
            document.getElementById('liveInside').innerText = d.present_now || 0;
            
            // Sync internal stats object for cards
            if(d.events) { globalStats = d.events; renderDashboardEvents(); }
        });

        // B. Watch Events
        onValue(ref(db, 'events'), s => {
            globalEvents = s.val() || {};
            renderDashboardEvents();
            renderConfigList();
        });

        // C. Watch Staff
        onValue(ref(db, 'users'), s => {
            const t = document.getElementById('userTable'); t.innerHTML='';
            if(s.exists()) Object.entries(s.val()).forEach(([k,v]) => {
                t.innerHTML += `<tr><td>${v.email}</td><td><span class="badge bg-secondary">${v.role}</span></td><td class="font-monospace text-primary fw-bold">${v.password}</td><td><button class="btn btn-sm btn-danger" onclick="remUser('${k}')">X</button></td></tr>`;
            });
        });
        
        // D. Watch Lock
        onValue(ref(db, 'system/scannerLock'), s => document.getElementById('lockSw').checked = s.val());
    }

    // 3. RENDER FUNCTIONS
    function renderDashboardEvents() {
        const div = document.getElementById('dashboardEvents');
        div.innerHTML = '';
        if(!Object.keys(globalEvents).length) { div.innerHTML='<div class="col-12 text-muted">No active events</div>'; return; }

        Object.entries(globalEvents).forEach(([id, evt]) => {
            const st = globalStats[evt.name] || {in:0, out:0, completed:0}; // Note: accessing by name to match Scanner V8 logic
            const isEnt = evt.category === 'ENTRANCE';
            const badge = isEnt ? 'bg-primary' : 'bg-warning text-dark';

            let grid = isEnt 
                ? `<div class="rt-grid"><div><div class="rt-lbl text-success">IN</div><div class="rt-val">${st.in||0}</div></div><div><div class="rt-lbl text-danger">OUT</div><div class="rt-val">${st.out||0}</div></div><div><div class="rt-lbl text-primary">NET</div><div class="rt-val">${(st.in||0)-(st.out||0)}</div></div></div>`
                : `<div class="rt-grid" style="grid-template-columns:1fr;"><div class="rt-lbl">COMPLETED</div><div class="h2 fw-bold text-primary m-0">${st.completed||0}</div></div>`;

            div.innerHTML += `<div class="col-md-4"><div class="stat-card"><div class="d-flex justify-content-between"><h6 class="fw-bold m-0">${evt.name}</h6><span class="badge ${badge}">${evt.category}</span></div>${grid}</div></div>`;
        });
    }

    function renderConfigList() {
        const div = document.getElementById('eventList');
        div.innerHTML = '';
        Object.entries(globalEvents).forEach(([id, evt]) => {
            let acts = '';
            if(role === 'admin') {
                const chk = evt.visible !== false ? 'checked' : '';
                acts = `<div class="d-flex gap-3 align-items-center"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" onchange="visToggle('${id}',this.checked)" ${chk}></div><button class="btn btn-sm btn-outline-danger" onclick="delEvt('${id}')"><i class="bi bi-trash"></i></button></div>`;
            } else {
                acts = '<span class="badge bg-secondary">Read Only</span>';
            }
            div.innerHTML += `<div class="bg-white border p-3 rounded mb-2 d-flex justify-content-between align-items-center"><div><div class="fw-bold">${evt.name}</div><small class="text-muted">[${evt.buttons}]</small></div>${acts}</div>`;
        });
    }

    // 4. REGISTRATION
    window.parseCSV = () => {
        const txt = document.getElementById('csvInput').value;
        if(!txt.trim()) return Swal.fire('Warn','Empty','warning');
        parsedData=[];
        let html='';
        txt.split('\n').forEach(l=>{
            const c=l.split(',');
            if(c.length>=2){
                const s={id:c[0].trim(),name:c[1].trim(),emg:c[2]?.trim()||'-',med:c[3]?.trim()||'None',ldr:c[4]?.trim()||'-'};
                if(s.id){parsedData.push(s); html+=`<tr><td class="fw-bold text-primary">${s.id}</td><td>${s.name}</td><td>${s.emg}</td><td class="${s.med!=='None'?'text-danger fw-bold':''}">${s.med}</td><td>${s.ldr}</td></tr>`;}
            }
        });
        document.getElementById('previewBody').innerHTML=html;
        document.getElementById('previewArea').style.display='block';
    };

    window.registerAndPrint = async () => {
        if(!parsedData.length) return;
        showLoad(true);
        const up = {};
        parsedData.forEach(s => {
            const k = s.id.replace(/[.#$/[\]]/g, '_');
            up[`scouts_basic/${k}`] = {id:s.id, name:s.name};
            up[`scouts_details/${k}`] = {emg:s.emg, med:s.med, ldr:s.ldr};
        });
        up['stats/total_registered'] = increment(parsedData.length);
        
        try {
            await update(ref(db), up);
            await genPDF(parsedData);
            showLoad(false);
            Swal.fire('Success','Done','success');
            document.getElementById('previewArea').style.display='none';
            document.getElementById('csvInput').value='';
            parsedData=[];
        } catch(e) { showLoad(false); Swal.fire('Error',e.message,'error'); }
    };

    // 5. FUNCTIONS
    window.autoFill = () => document.getElementById('evtBtns').value = document.getElementById('evtCat').value==='ENTRANCE'?'IN,OUT':'COMPLETED';
    window.createNewEvent = async () => {
        const name = document.getElementById('evtName').value;
        if(!name) return Swal.fire('Err','Name Needed','error');
        await push(ref(db, 'events'), {
            name, 
            category: document.getElementById('evtCat').value,
            mode: document.getElementById('evtMode').value,
            buttons: document.getElementById('evtBtns').value.split(',').map(b=>b.trim().toUpperCase()),
            visible: true
        });
        Swal.fire('OK','Event Created','success');
        document.getElementById('evtName').value='';
    };
    window.visToggle = (id, s) => { if(role==='admin') update(ref(db,`events/${id}`), {visible:s}); };
    window.delEvt = (id) => { if(role==='admin' && confirm('Del?')) remove(ref(db,`events/${id}`)); };

    // 6. DATA & UTILS
    window.backupDB = async () => {
        showLoad(true);
        const b = (await get(ref(db,'scouts_basic'))).val() || {};
        const d = (await get(ref(db,'scouts_details'))).val() || {};
        const blob = new Blob([JSON.stringify({basic:b, details:d})], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='Backup.json'; a.click();
        showLoad(false);
    };
    window.restoreDB = (inp) => {
        const f = inp.files[0]; if(!f) return;
        const r = new FileReader();
        r.onload = async(e) => {
            if(confirm("Overwrite?")) {
                const d = JSON.parse(e.target.result);
                showLoad(true); await update(ref(db), {scouts_basic:d.basic, scouts_details:d.details});
                showLoad(false); Swal.fire('Done','Restored','success');
            }
        }; r.readAsText(f);
    };
    window.sysReset = async () => {
        if(role!=='admin') return;
        const {value:k} = await Swal.fire({title:'RESET', text:'Master Key', input:'password'});
        if(k==="200431504082") {
            showLoad(true); await update(ref(db), {scouts_basic:null, scouts_details:null, logs:null, stats:null});
            location.reload();
        }
    };
    window.exportLogs = async () => {
        const s = await get(ref(db, 'logs'));
        if(!s.exists()) return Swal.fire('Empty','No logs','info');
        let c="Time,ID,Name,Event,Action\n";
        Object.values(s.val()).forEach(l=> c+=`"${new Date(l.timestamp).toLocaleString()}","${l.scoutID}","${l.scoutName}","${l.event}","${l.action}"\n`);
        const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([c])); a.download='Logs.csv'; a.click();
    };

    // 7. SEARCH & STAFF
    window.performSearch = async () => {
        const id = document.getElementById('sInput').value.trim();
        if(!id) return;
        const k = id.replace(/[.#$/[\]]/g, '_');
        const b = await get(ref(db, `scouts_basic/${k}`));
        if(b.exists()) {
            const v = b.val();
            const d = (await get(ref(db, `scouts_details/${k}`))).val() || {emg:'-', med:'-', ldr:'-'};
            document.getElementById('sName').innerText = v.name; document.getElementById('sID').innerText = v.id;
            document.getElementById('sEmg').innerText = d.emg; document.getElementById('sMed').innerText = d.med; document.getElementById('sLdr').innerText = d.ldr;
            foundScout = {id:v.id, name:v.name};
            document.getElementById('sResult').style.display = 'block';
        } else Swal.fire('Error','Not Found','error');
    };
    window.downloadSingleID = () => { if(foundScout) genPDF([foundScout]); };

    window.addUser = async () => {
        if(role!=='admin') return;
        const e=document.getElementById('uEmail').value, p=document.getElementById('uPass').value, r=document.getElementById('uRole').value;
        if(e&&p) {
            try {
                const u = await createUserWithEmailAndPassword(secAuth,e,p);
                await set(ref(db,`users/${u.user.uid}`), {email:e, role:r, password:p});
                await signOut(secAuth); Swal.fire('OK','Added','success');
            } catch(x) { Swal.fire('Err',x.message,'error'); }
        }
    };
    window.remUser = (k) => { if(role==='admin' && confirm('Del?')) remove(ref(db,`users/${k}`)); };

    // UTILS
    async function genPDF(l) {
        const {jsPDF}=window.jspdf; const doc=new jsPDF('p','mm','a4'); const qr=document.getElementById('qr-hidden');
        const w=52.5, h=74.25;
        for(let i=0; i<l.length; i++) {
            if(i>0&&i%16===0) doc.addPage();
            const x=(i%4)*w, y=Math.floor((i%16)/4)*h;
            doc.setDrawColor(200); doc.rect(x,y,w,h);
            doc.setFontSize(8); doc.text("SCOUTPASS",x+w/2,y+8,{align:'center'});
            qr.innerHTML=''; new QRCode(qr,{text:l[i].id, width:100, height:100}); await new Promise(r=>setTimeout(r,10));
            doc.addImage(qr.querySelector('canvas').toDataURL(),'PNG',x+w/2-15,y+15,30,30);
            doc.setFontSize(12); doc.text(l[i].id,x+w/2,y+50,{align:'center'});
            doc.setFontSize(9); doc.text(doc.splitTextToSize(l[i].name,w-4),x+w/2,y+56,{align:'center'});
        }
        doc.save('IDs.pdf');
    }
    window.setLock = (c) => set(ref(db,'system/scannerLock'),c);
    window.logout=()=>signOut(auth).then(()=>location.href="index.html");
    window.showSection=(id,el)=>{
        if(role==='moderator' && (id==='staff'||id==='settings')) return;
        document.querySelectorAll('.section').forEach(s=>s.style.display='none');
        document.getElementById('sec-'+id).style.display='block';
        document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
        el.classList.add('active');
    };
    function showLoad(v) { document.getElementById('loadingOverlay').style.display = v ? 'flex' : 'none'; }

    // Bind
    window.createNewEvent=createNewEvent; window.autoFill=autoFill; window.visToggle=visToggle; window.delEvt=delEvt;
    window.parseCSV=parseCSV; window.registerAndPrint=registerAndPrint;
    window.backupDB=backupDB; window.restoreDB=restoreDB; window.exportLogs=exportLogs; window.sysReset=sysReset;
    window.performSearch=performSearch; window.downloadSingleID=downloadSingleID;
    window.addUser=addUser; window.remUser=remUser; window.setLock=setLock;
</script>
</body>
</html>

